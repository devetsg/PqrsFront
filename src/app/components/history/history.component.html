<div class="resp">
  <div class="resp--container">
    <form class="resp--container-form" [formGroup]="formResponse">

      <!-- Box 1: Encabezados -->
      <div class="resp--container-box1">
        <div *ngIf="pqrHeaders != undefined" class="resp--container-box1-texts">
          <h2 class="resp--labels">{{pqrHeaders.subject}}</h2>
          <h2 class="response--labels-data">{{pqrHeaders.sentTime}}</h2>
        </div>
      </div>

      <!-- Box 2: Datos de correo -->
      <div *ngIf="pqrHeaders != undefined" class="resp--container-box2">
        <div class="resp--container-box2-banners">
          <div class="response--headers-container-data aling-center dp-block">
            <div class="circle-name relative">
              {{ getFirstLetter(pqrHeaders.from.replaceAll('"', '')) }}
            </div>
            <div class="">
              <h2 class="response--labels-data">{{pqrHeaders.from.replaceAll('"','')}}</h2>
              <div class="response--headers-container-data dp-block">
                <h2 class="response--labels">Para:</h2>
                <h2 class="response--labels-data">{{pqrHeaders.to.replaceAll('"','')}}</h2>
              </div>
            </div>
          </div>
          <div *ngIf="pqrHeaders.cc" class="response--headers-container-data" style="padding: 1rem 0;">
            <h2 class="response--labels">CC:</h2>
            <h2 class="response--labels-data">{{pqrHeaders.cc}}</h2>
          </div>
        </div>

        <div class="resp--container-box2-mail">
          <mat-form-field appearance="fill">
            <mat-label></mat-label>
            <textarea class="" matInput formControlName="pqrText" readonly></textarea>
          </mat-form-field>
        </div>
      </div>

      <!-- Box 3: Adjuntos -->
      <div class="resp--container-box3">
        <h2 class="resp--container-box3-title">Adjuntos</h2>
        <div class="resp--container-box3-attachs">
          <div *ngFor="let name of filteredAttachments" class="resp--labels-data flex div-doc">
            <div class="flex" (click)="getAttach(name)">
              <img [src]="getIcon(name)" alt="Icon" style="width: 30px; height: 30px; margin-right: 10px;">
              {{ truncateFilename(name.replace('Resources/Attach/', ''), 20) }}
            </div>
          </div>

          <div *ngIf="minedAttachments.length > 0">
            <h2 style="margin-bottom: 15px;" class="response--labels">Datos Minados: 
              <i style="font-size: 25px;" class="bi bi-database-fill-check"></i>
            </h2>        
            <div *ngFor="let name of minedAttachments" class="response--labels-data flex div-doc">
              <div class="flex" (click)="getAttach(name)">
                <img [src]="getIcon(name)" alt="Icon" style="width: 30px; height: 30px; margin-right: 10px;">
                {{ truncateFilename(name.replace('Resources/Attach/', ''), 20) }}
              </div>
            </div>
          </div>  
        </div>

        <div class="flex">          
          <div class="w100 pl-1" [ngClass]="{'display-block': isOpen, 'display-none': !isOpen}">
            <div class="flex w100 space-between">
              <i class="bi bi-x-circle" style="font-size: 20px; color: #075f47;cursor:pointer;" (click)="closeDoc()"></i>
            </div>
            <div class="response--visors-container-visor">
              <div *ngIf="pdfSrc">
                <object [attr.data]="pdfSrc" type="application/pdf" width="100%" height="600px">
                  <p>
                    Tu navegador no soporta la visualización de PDF. Puedes
                    <a [href]="pdfSrc">descargar el archivo aquí</a>.
                  </p>
                </object>
              </div>
              <div class="response--visors-container-visor-excel">
                <app-file-viewer-excel *ngIf="excelSrc != false" [fileUrl]="excelSrc!.toString()"></app-file-viewer-excel>
              </div>
            </div>
          </div>          
        </div>
      </div>

      <!-- Box 4: Cuerpo del correo -->
      <div class="resp--container-box4">
        <h2 class="resp--container-box3-title">Cuerpo del correo</h2>
        <mat-form-field class="textareaclara" appearance="fill">
          <mat-label></mat-label>
          <textarea class="response--fields" matInput formControlName="response" readonly></textarea>
        </mat-form-field>
      </div>

      <!-- Box 5: Cuerpo de la carta de respuesta (solo lectura) -->
      <div class="resp--container-box5">
        <h2 *ngIf="(this.pqr != undefined && this.pqr.pqrType.name == 'Queja')" 
            class="resp--container-box3-title">
          Cuerpo de la carta de respuesta
        </h2>
        <div class="resp--container-box5-editor">
          <ckeditor *ngIf="Editor" 
            [editor]="Editor" 
            [config]="editorConfig"
            [formControl]="bodyControl"
            [disabled]="true"
            style="height: 400px;">
          </ckeditor>

          <div class="response--attachs-response" *ngIf="!withAttachResponse">
            <h4 class="response--attachs-response-title">Respuesta Sin Archivos Adjuntos</h4>
          </div>
          <div class="response--attachs-response" *ngIf="withAttachResponse">
            <h4 class="response--attachs-response-title">Archivos Adjuntos a la respuesta</h4>
            <i class="bi bi-cloud-download-fill" style="font-size:25px;cursor:pointer;" (click)="downloadFile()"></i>
          </div>
        </div>

        <div class="resp--container-box5-see">
          <div *ngIf="bodyPdfUrl" class="response--visor">
            <object [data]="this.bodyPdfUrl" type="application/pdf" width="100%" height="600px">
              <p>
                Tu navegador no soporta la visualización de PDF. Puedes
                <a [href]="pdfSrc">descargar el archivo aquí</a>.
              </p>
            </object>
          </div>
        </div>
      </div>

      <!-- Box 6: Chat -->
      <div class="resp--container-box6">
        <div class="response--chat">
          <div class="response--chat-title-container">
            <h2 class="response--chat-conatiner-title">Chat</h2>
          </div>
          <div class="response--chat-conatiner">
            <div class="relative" *ngFor="let msg of messages" 
                [ngClass]="{'user-class': msg.type === 'USER', 'dir-class': msg.type === 'DIR'}">
              <h5 class="response--chat-conatiner-info-data absolute name-color">{{msg.sendBy}}</h5>
              <h5 class="width-msgs font-400">{{msg.content}}</h5>
              <div class="response--chat-conatiner-info">
                <h5 class="response--chat-conatiner-info-data name-color">
                  {{msg.dateMessage | date: 'dd/MM/yyyy, HH:mm' }}
                </h5>
              </div>
            </div>
          </div>
          <div class="response--attachs-response2 flex-resp">
            <div class="response--attachs-response" *ngIf="!withAttachResponse2">
              <h4 class="response--attachs-response-title">Sin Archivos Adjuntos Para El Chat</h4>
            </div>
            <div class="response--attachs-response" *ngIf="withAttachResponse2">
              <h4 class="response--attachs-response-title">Archivos Adjuntos del Chat</h4>
              <i class="bi bi-cloud-download-fill" style="font-size:25px;cursor:pointer;" (click)="downloadFile2()"></i>
            </div>
          </div>
        </div>
      </div>

    </form>
  </div>
</div>